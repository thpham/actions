# Reusable workflow for GitHub Actions workflow validation
# Uses actionlint for syntax checking and zizmor for security scanning
#
# Can be used as:
# 1. Reusable workflow (workflow_call) - called by other repos
# 2. Direct trigger (push/pull_request) - lints this repo's workflows

name: Lint Workflows

on:
  # Direct triggers for this repo
  push:
    branches:
      - main
      - master
      - "release/**"
    paths:
      - ".github/workflows/**"
      - ".github/actionlint.yaml"
  pull_request:
    branches:
      - main
      - master
      - "release/**"
    paths:
      - ".github/workflows/**"
      - ".github/actionlint.yaml"
  # Reusable workflow trigger
  workflow_call:
    inputs:
      actionlint-config:
        description: "Path to actionlint config file"
        required: false
        type: string
        default: ".github/actionlint.yaml"
      enable-zizmor:
        description: "Enable zizmor security scanning"
        required: false
        type: boolean
        default: true
      runner:
        description: "Runner to use"
        required: false
        type: string
        default: "ubuntu-latest"

concurrency:
  group: lint-workflows-${{ github.repository }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  actionlint:
    name: actionlint
    runs-on: ${{ inputs.runner || 'ubuntu-latest' }}
    steps:
      - name: Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
        with:
          persist-credentials: false

      - name: Run actionlint
        uses: rhysd/actionlint@0933c147c9d6587653d45fdcb4c497c57a65f9af # v1.7.10

  zizmor:
    name: zizmor (Security)
    runs-on: ${{ inputs.runner || 'ubuntu-latest' }}
    if: ${{ inputs.enable-zizmor == true || inputs.enable-zizmor == null }}
    permissions:
      contents: read
      actions: read
      security-events: write
    steps:
      - name: Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
        with:
          persist-credentials: false

      - name: Run zizmor
        # v0.3.0 - Uploads to GitHub Advanced Security automatically
        uses: zizmorcore/zizmor-action@e639db99335bc9038abc0e066dfcd72e23d26fb4 # v0.3.0
